<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        canvas {
            border: 1px solid red;
        }
    </style>
</head>
<body>
    <main id="main">
        <canvas id="canvas"></canvas>
        <canvas id="canvas_2"></canvas>
    </main>
</body>
<script>
    let masImag = [];
    let masPromis = [];
    let masUrlImg = [
    	'img/serfing.jpg',
        'img/snow.png',
        'img/kit.jpg'
    ];

    let canvas = document.getElementById('canvas');
    canvas.setAttribute('width', 800);
    canvas.setAttribute('height', 500);
    let ctx = canvas.getContext('2d');

    masUrlImg.forEach( x => { masPromis.push(loadImage(x)); });
    let ppp;
    Promise.all(masPromis).then( result => {
        
	    masImag = result.map( zn => zn );
        ppp = new elemImgCanvas(
        	masImag[1],
            440,
            440,
            0,
            0,
            0,
            0.2,
            0.5,
            0.5
        );
        console.log("vvvvvvvvv", ppp );

        if (ctx) animRotation();
    });



    let canvas_2 = document.getElementById('canvas_2');
    canvas_2.setAttribute('width', 800);
    canvas_2.setAttribute('height', 500);
    let ctx_2 = canvas_2.getContext('2d');

    let degre = 0;
    let posY = 220;
    let posX = 220;
    let dAcs = 0.01;

    function loadImage(src) {
        let img = new Image();
        img.src = src;
        return new Promise( (resolve, reject) => {
	        img.onload = function () {
	            resolve(img);
            }
        });
    }
    
    function animRotation() {
	    ctx.clearRect(0, 0, ctx.canvas.offsetWidth, ctx.canvas.offsetHeight);

	    ctx.translate(ppp.posX, ppp.posY);
	    ctx.rotate(inRad(ppp.angle));
//        debugger
	    ctx.drawImage(ppp.img, -ppp.width/2, -ppp.height/2);
	    ctx.rotate(inRad(-ppp.angle));
	    ctx.translate(-ppp.posX, -ppp.posY);

//	    dAcs += 0.01;
	    ppp.angle += ppp.speedAngle;

	    if (ppp.posX - ppp.width/2 > ctx.canvas.offsetWidth) {
		    ppp.posX = -ppp.width/2;
	    } else {
		    ppp.posX += ppp.transY;
	    }

	    if (ppp.posY - ppp.height/2 > ctx.canvas.offsetHeight) {
		    ppp.posY = -ppp.height/2;
        } else {
		    ppp.posY += ppp.transY;
        }

	    ctx.globalCompositeOperation = 'source-in';
	    ctx.drawImage(masImag[0], 0, 0);
	    ctx.globalCompositeOperation = 'source-over';

	    ctx_2.drawImage(masImag[2], 0, 0);
	    ctx_2.drawImage(canvas, 0, 0);

	    requestAnimationFrame( animRotation )
    }

    function inRad(num) {
	    return num * Math.PI / 180;
    }

    function elemImgCanvas(img, height, width, posX, posY, angle, speedAngle, transX, transY) {
    	this.img = img;
	    this.width = width;
	    this.height = height;
    	this.posX = posX;
    	this.posY = posY;
    	this.angle = angle;
    	this.speedAngle = speedAngle;
    	this.transX = transX;
    	this.transY = transY;
    }
</script>
</html>